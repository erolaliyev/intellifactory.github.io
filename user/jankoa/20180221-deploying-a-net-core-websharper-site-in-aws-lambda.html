<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deploying a .NET Core WebSharper site in AWS Lambda | IntelliFactory</title>
  <meta name="description" content="" />
  <script src="/themekit/scripts/jquery.min.js"></script>
  <script src="/themekit/scripts/main.js"></script>
  <link rel="stylesheet" href="/themekit/css/bootstrap-grid.css" />
  <link rel="stylesheet" href="/themekit/css/style.css" />
  <link rel="stylesheet" href="/themekit/css/content-box.css" />
  <link rel="stylesheet" href="/themekit/css/media-box.css" />
  <link rel="stylesheet" href="/themekit/css/social.css" />
  <link rel="stylesheet" href="/assets/skin.css" />
  <link rel="stylesheet" href="/assets/custom.css" />
  <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" type="text/javascript" charset="UTF-8"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/fsharp.min.js" type="text/javascript" charset="UTF-8"></script><link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/vs.min.css"></link>

</head>
<body>
  <div id="preloader"></div>
  <nav class="menu-classic  light menu-fixed menu-one-page align-right" data-menu-anima="fade-bottom" data-scroll-detect="true">
    <div class="container">
        <div class="menu-brand">
          <a href="#">
            <img class="logo-default" src="/media/logo-light.svg" alt="logo" />
            <img class="logo-retina" src="/media/logo-light.svg" alt="logo" />
            <span>IntelliFactory</span>
          </a>
        </div>
        <i class="menu-btn"></i>
        <div class="menu-cnt">
          <ul>
            <li>
              <a href="index.html">Home</a>
            </li>
            <li class="dropdown">
              <a href="#">Open Source</a>
              <ul>
                <li><a href="https://websharper.com">WebSharper</a></li>
                <li><a href="https://fsbolero.io">Bolero</a></li>
                <li><a href="https://github.com/granicz/SiteFi">SiteFi</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#">Company</a>
              <ul>
                <li><a href="/about">About</a></li>
                <li><a href="/careers">Careers</a></li>
                <li><a href="/customers">Success stories</a></li>
                <li><a href="/team">Team</a></li>
                <li><a href="/investors">For investors</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#">Services</a>
              <ul>
                <li><a href="/consulting">Consulting</a></li>
                <li><a href="/trainings">Trainings</a></li>
                <li><a href="/education">Education</a></li>
                <li><a href="/research">Research</a></li>
              </ul>
            </li>
            <li>
              <a href="/blogs">Blogs</a>
            </li>
            <li>
              <a href="/contact">Contact</a>
            </li>
          </ul>
          <div class="menu-right">
            <div class="menu-custom-area">
              <a class="btn btn-xs btn-border btn-circle" href="https://cloudsharper.com">Download CloudSharper</a>
            </div>
          </div>
          <div class="clear"></div>
        </div>
      </div></nav>

  
    
    <header class="header-image ken-burn-center align-center light boxed-page-header" data-parallax="true" data-natural-height="600" data-natural-width="1920" data-bleed="0" data-image-src="http://via.placeholder.com/1920x700" data-offset="0">
      <div class="container">
        <h1>Deploying a .NET Core WebSharper site in AWS Lambda</h1>
        <h2>20180221</h2>
        <ol class="breadcrumb">
          <li><a href="/index.html">Home</a></li>
          <li><a href="/blogs">Blogs</a></li>
          <li><a href=""></a></li>
        </ol>
      </div>
    </header>
    <main>
      <section class="section-base boxed-page">
        <div class="container">
          <div class="row">
            <div class="col-lg-9 text-color">
              <div><div ws-preserve=""><p>With the .NET Core support added to AWS lambda, it is a great platform to run services or sites that are stateless and lightweight.
A free AWS account is enough to try this, up to one million requests per month. <a href="https://github.com/dotnet-websharper/core">WebSharper 4.2</a>'s new .NET Core templates can be quickly configured to be published on Lambda.</p>
<p>You can use <a href="https://docs.aws.amazon.com/sdk-for-net/v3/developer-guide/net-dg-signup.html">this guide</a> for signing up for an AWS account, and to download and configure your credentials for use by the command tool or the AWS Toolkit for Visual Studio.</p>
<h1 id="setting-up">Setting up</h1>
<p>First, install the templates if you don't have them yet, with:</p>
<pre><code>dotnet new -i WebSharper.Templates
</code></pre>
<p>Create a new empty folder, with the name you want for your project (for example <code>LambdaWS</code>) and run one of:</p>
<pre><code>-- to create a C# site:
dotnet new websharper-web 
-- to create an F# site:
dotnet new websharper-web -lang f#
</code></pre>
<p>Next, adding some packages:</p>
<pre><code>dotnet add package Microsoft.AspNetCore.All -v 2.0.3
dotnet add package Amazon.Lambda.AspNetCoreServer
dotnet add package AWSSDK.Extensions.NETCore.Setup
</code></pre>
<p>The <code>AWSSDK.Extensions.NETCore.Setup</code> will be only needed if you want to use other AWS services like S3 or DynamoDB.
Although <code>Microsoft.AspNetCore.All</code> is already installed for the template, AWS Lambda supports it only up to version 2.0.3, so it needs to be downgraded.</p>
<p>To get access to the <code>dotnet lambda</code> CLI, we also need a <code>DotNetCliToolReference</code> in the project file, add this inside the root <code>Project</code> node:</p>
<pre><code>  &lt;ItemGroup&gt;
    &lt;DotNetCliToolReference Include=&quot;Amazon.Lambda.Tools&quot; Version=&quot;2.1.0&quot; /&gt;
  &lt;/ItemGroup&gt;
</code></pre>
<p>Then run <code>dotnet restore</code> to install the CLI tool. (<a href="https://github.com/NuGet/Home/issues/4901">Eventually</a> this will all be done automatically by <code>dotnet install tool -g Amazon.Lambda.Tools</code>)</p>
<h1 id="adding-the-entry-point">Adding the entry point</h1>
<p>Open your <code>Program.cs</code> or <code>Program.fs</code> file, and add this new class that will work as the entry point for the Lambda function.
You can leave the existing <code>Program</code> class/module, so the application will continue to run locally with Kestrel or in IIS too.</p>
<p>For C#:</p>
<pre><code class="language-csharp">public class LambdaEntryPoint : Amazon.Lambda.AspNetCoreServer.APIGatewayProxyFunction 
{
    protected override void Init (IWebHostBuilder builder)
    {
        builder.UseStartup&lt;Startup&gt;();
    }
}
</code></pre>
<p>For F#:</p>
<pre><code class="language-fsharp">type LambdaEntryPoint() =
    inherit Amazon.Lambda.AspNetCoreServer.APIGatewayProxyFunction()
    
    override this.Init(builder) =
        builder.UseStartup&lt;Startup&gt;() |&gt; ignore
</code></pre>
<h1 id="adding-a-serverless.template">Adding a serverless.template</h1>
<p>For multi-page applications to run correctly, we need separate AWS Lambda functions to handle the root and the sub-paths.
The easiest way to manage this is by using AWS CloudFormation, which enables handling multipe service installations under a single stack name.
Create a file called <code>serverless.template</code>, and add this as content:</p>
<pre><code>{
  &quot;AWSTemplateFormatVersion&quot; : &quot;2010-09-09&quot;,
  &quot;Transform&quot; : &quot;AWS::Serverless-2016-10-31&quot;,
  &quot;Description&quot; : &quot;An AWS Serverless Application.&quot;,

  &quot;Resources&quot; : {

    &quot;ProxyFunction&quot; : {
      &quot;Type&quot; : &quot;AWS::Serverless::Function&quot;,
      &quot;Properties&quot;: {
        &quot;Handler&quot;: &quot;LambdaWS::LambdaWS.LambdaEntryPoint::FunctionHandlerAsync&quot;,
        &quot;Runtime&quot;: &quot;dotnetcore2.0&quot;,
        &quot;CodeUri&quot;: &quot;&quot;,
        &quot;MemorySize&quot;: 512,
        &quot;Timeout&quot;: 30,
        &quot;Role&quot;: null,
        &quot;Policies&quot;: [ &quot;AWSLambdaFullAccess&quot; ],
        &quot;Environment&quot; : {
          &quot;Variables&quot; : {
          }
        },
        &quot;Events&quot;: {
          &quot;PutResource&quot;: {
            &quot;Type&quot;: &quot;Api&quot;,
            &quot;Properties&quot;: {
              &quot;Path&quot;: &quot;/{proxy+}&quot;,
              &quot;Method&quot;: &quot;ANY&quot;
            }
          }
        }
      }
    },
    
    &quot;RootPathFunction&quot; : {
      &quot;Type&quot; : &quot;AWS::Serverless::Function&quot;,
      &quot;Properties&quot;: {
        &quot;Handler&quot;: &quot;LambdaWS::LambdaWS.LambdaEntryPoint::FunctionHandlerAsync&quot;,
        &quot;Runtime&quot;: &quot;dotnetcore2.0&quot;,
        &quot;CodeUri&quot;: &quot;&quot;,
        &quot;MemorySize&quot;: 512,
        &quot;Timeout&quot;: 30,
        &quot;Role&quot;: null,
        &quot;Policies&quot;: [ &quot;AWSLambdaFullAccess&quot; ],
        &quot;Events&quot;: {
          &quot;PutResource&quot;: {
            &quot;Type&quot;: &quot;Api&quot;,
            &quot;Properties&quot;: {
              &quot;Path&quot;: &quot;/&quot;,
              &quot;Method&quot;: &quot;ANY&quot;
            }
          }
        }
      }
    }
  },

  &quot;Outputs&quot; : {
  }
}
</code></pre>
<p>Modify assembly and namespace name from <code>LambdaWS</code> to the name of your project if different.</p>
<h1 id="deployment">Deployment</h1>
<p>We are ready to deploy our first test site. It can be done both from command line or using Visual Studio.
First let's keep using the command line. (You can jump ahead to use Visual Studio for a quicker setup.)
Run this with your profile name:</p>
<pre><code>dotnet lambda deploy-serverless --configuration Release --framework netcoreapp2.0 --profile YourProfileName
</code></pre>
<p>This will ask for multiple additional inputs.
First the name of the stack. You can give a unique name to create a new one.
Then the name of an S3 bucket. Create one in <a href="https://s3.console.aws.amazon.com/s3/">AWS Console</a> for the region you are targeting and paste its name.
Next the serverless template file, enter <code>serverless.template</code>.
Last the region where you want to deploy to (for example <code>us-east-2</code>, must be where your S3 bucket is located).</p>
<p>After the deployment finishes, you can check your Lambda functions in <a href="https://console.aws.amazon.com/lambda/">AWS Console</a> to find the <code>RootPathFunction</code> belonging to the newly deployed stack.
Click it then <code>API Gateway</code>, scroll down to see its properties and open dropdown to see the Invoke URL where you can reach your application.</p>
<p><img src="https://i.imgur.com/Em5ky7e.png" alt="Deployed app" /></p>
<h1 id="deploying-and-configuring-via-aws-toolkit">Deploying and configuring via AWS Toolkit</h1>
<p>If you are using Visual Studio, it is helpful to install the <a href="https://aws.amazon.com/visualstudio/">AWS Toolkit for Visual Studio</a>.
This adds the AWS Explorer to view and manage your deployed resources, and also right-click commands for the Solution Explorer to deploy projects.
Clicking <code>Publish to AWS Lambda...</code> on the project node opens a dialog where you can set your AWS account, region and stack name. These will all get saved automatically to a <code>aws-lambda-tools-defaults.json</code> file upon publishing, so you don't need to specify them again when updating.</p>
<p><img src="https://i.imgur.com/CUmac84.png" alt="Publish dialog" /></p>
<p>Click <code>Publish</code> and when status is displaying <code>CREATE_COMPLETE</code>, you can click the link at <code>AWS Serverless URL</code> to see the sample page running.</p>
<p><img src="https://i.imgur.com/berW90e.png" alt="Publish result" /></p>
<h1 id="to-be-continued">To be continued</h1>
<p>We will be picking it up from here with:</p>
<ul>
<li>Optimizing deployment so that static files are using S3 instead of the lambda function (more cost effective).</li>
<li>Using S3 from within a lambda function.</li>
<li>Creating a JSON API in WebSharper to run on Lambda.</li>
<li>Logging and configuration integration with Lambda.</li>
</ul>
</div></div>
              <hr class="space" />
              <div class="row">
                <div class="col-lg-8">
                  <ul class="icon-list icon-list-horizontal icon-list-blog">
                    <li>
                      <i class="icon-bookmark"></i>
                      <a href="#">Finance</a>,
                      <a href="#">Software</a>
                    </li>
                  </ul>
                </div>
              </div>
              <hr class="space" />
              <div class="icon-links icon-links-button full-width icon-social social-colors">
                <a data-social="share-facebook" class="facebook"><i class="icon-facebook"></i></a>
                <a data-social="share-twitter" class="twitter"><i class="icon-twitter"></i></a>
                <a data-social="share-linkedin" class="linkedin"><i class="icon-linkedin"></i></a>
                <a data-social="share-pinterest" class="pinterest"><i class="icon-pinterest"></i></a>
              </div>
              <hr />
              <div class="cnt-box cnt-box-side box-small">
                <a href="#" class="img-box"><img src="http://via.placeholder.com/450x450" alt="" /></a>
                <div class="caption">
                  <h2>Richard Scally</h2>
                  <p>
                    Lorem ipsum dolor sitamet consectetur adipisicing elito sed do eiusmod tempore ectetur adipia.
                  </p>
                </div>
              </div>
              <hr />
              <h2>Related articles.</h2>
              <hr class="space-sm" />
              <div class="grid-list" data-columns="2" data-columns-sm="1">
                <div class="grid-box">
                  <div class="grid-item">
                    <div href="#" class="cnt-box cnt-box-top-icon boxed doc-boxed align-left">
                      <div class="caption">
                        <h2>Jessica Adams Exibition In New York With After Show</h2>
                        <div class="extra-field">Technology</div>
                        <p>
                          October 25, 2019
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="grid-item">
                    <div href="#" class="cnt-box cnt-box-top-icon boxed doc-boxed align-left">
                      <div class="caption">
                        <h2>How to change your business and make money</h2>
                        <div class="extra-field">Business</div>
                        <p>
                          October 24, 2019
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 widget">
              
              <div>
                <h3>Categories</h3>
                <hr class="space-xs" />
                <div class="tabs"><div>
                    <a href="/category/aws">
                      aws
                    </a>
                  </div><div>
                    <a href="/category/csharp">
                      csharp
                    </a>
                  </div><div>
                    <a href="/category/fsharp">
                      fsharp
                    </a>
                  </div><div>
                    <a href="/category/serverless">
                      serverless
                    </a>
                  </div><div>
                    <a href="/category/websharper">
                      websharper
                    </a>
                  </div></div>
                <hr class="space-sm" />
                <h3>Latest posts</h3>
                <hr class="space-sm" />
                <div class="menu-inner menu-inner-vertical menu-inner-image">
                    <ul>
                      <li>
                        <a href="/user/denuziere/20200523-bolero-0-13-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.13 released" />
                          Bolero 0.13 released
                          <span>05/23/2020</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20200323-bolero-0-12-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.12 released" />
                          Bolero 0.12 released
                          <span>03/23/2020</span>
                        </a>
                      </li><li>
                        <a href="/user/granicz/20200116-converting-a-websharper-html-app-to-a-client-server-one">
                          <img src="http://via.placeholder.com/400x400" alt="Converting a WebSharper HTML app to a client-server one" />
                          Converting a WebSharper HTML app to a client-server one
                          <span>01/16/2020</span>
                        </a>
                      </li><li>
                        <a href="/user/granicz/20191226-f-metablogging-introducing-blogengine-for-your-static-markdown-based-f-blog">
                          <img src="http://via.placeholder.com/400x400" alt="F# metablogging: introducing BlogEngine for your static markdown-based F# blog" />
                          F# metablogging: introducing BlogEngine for your static markdown-based F# blog
                          <span>12/26/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190924-bolero-0-9-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.9 released" />
                          Bolero 0.9 released
                          <span>09/24/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/granicz/20190905-your-first-bolero-project-not-compiling-try-this">
                          <img src="http://via.placeholder.com/400x400" alt="Your first Bolero project not compiling? Try this!" />
                          Your first Bolero project not compiling? Try this!
                          <span>09/05/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190805-bolero-0-7-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.7 released" />
                          Bolero 0.7 released
                          <span>08/05/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190530-bolero-0-5-released-for-blazor-3-0-preview">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.5 released for Blazor 3.0-preview" />
                          Bolero 0.5 released for Blazor 3.0-preview
                          <span>05/30/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190417-bolero-0-4-released-with-remote-authentication">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.4 released with remote authentication" />
                          Bolero 0.4 released with remote authentication
                          <span>04/17/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/jankoa/20190226-websharper-4-5-8-released-with-visual-studio-2019-support">
                          <img src="http://via.placeholder.com/400x400" alt="WebSharper 4.5.8 released with Visual Studio 2019 support" />
                          WebSharper 4.5.8 released with Visual Studio 2019 support
                          <span>02/26/2019</span>
                        </a>
                      </li>
                      
                    </ul>
                  </div>
                <hr class="space-sm" />
                <h3>Twitter</h3>
                <hr class="space-sm" />
                <div class="social-feed social-feed-tw social-slider" data-social-id="twitter" data-options="count:8,arrows:true,nav:true,controls:out,type:carousel,perView:1"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  
  <i class="scroll-top-btn scroll-top show"></i>
  <footer class="footer light">
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <h4>Company and team</h4>
          <div class="menu-inner menu-inner-vertical">
            <ul>
              <li>
                <a href="#">Company details and team</a>
              </li>
              <li>
                <a href="#">News and blog</a>
              </li>
              <li>
                <a href="#">Press area</a>
              </li>
              <li>
                <a href="#">Affiliates and marketing</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <h4>Help and support</h4>
          <div class="menu-inner menu-inner-vertical">
            <ul>
              <li>
                <a href="#">Help centre</a>
              </li>
              <li>
                <a href="#">Feedbacks</a>
              </li>
              <li>
                <a href="#">Request new features</a>
              </li>
              <li>
                <a href="#">Contact us</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <h4>Learn more</h4>
          <div class="menu-inner menu-inner-vertical">
            <ul>
              <li>
                <a href="#">Apps stores</a>
              </li>
              <li>
                <a href="#">Partners</a>
              </li>
              <li>
                <a href="#">Privacy and terms</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <h4>Follow us</h4>
          <div class="icon-links icon-social icon-links-grid social-colors">
            <a class="facebook"><i class="icon-facebook"></i></a>
            <a class="twitter"><i class="icon-twitter"></i></a>
            <a class="linkedin"><i class="icon-linkedin"></i></a>
            <a class="youtube"><i class="icon-youtube"></i></a>
            <a class="instagram"><i class="icon-instagram"></i></a>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bar">
      <div class="container">
        <span>© Codrop LTD 2019. Codrop is a powerful Landing Page App Template built with <a target="_blank" href="https://themekit.dev/code/">Themekit</a> by the <a target="_blank" href="https://schiocco.com/">Schiocco</a> Team. </span>
        <span><img src="/media/logo-light.svg" /></span>
      </div>
    </div>
    <link rel="stylesheet" href="/themekit/media/icons/iconsmind/line-icons.min.css" />
    <script src="/themekit/scripts/parallax.min.js"></script>
    <script src="/themekit/scripts/imagesloaded.min.js"></script>
    <script src="/themekit/scripts/pagination.min.js"></script>
    <script src="/themekit/scripts/social.min.js"></script>
    <script src="/themekit/scripts/tab-accordion.js"></script>
    <script src="/media/custom.js"></script>
    <script src="/js/Client.js"></script>
    <meta id='websharper-data' name='websharper-data' content='{"$TYPES":[],"$DATA":{"$V":{}}}' />
<script src="../../Scripts/WebSharper.Core.JavaScript/Runtime.js" type="text/javascript" charset="UTF-8"></script><script type="text/javascript">
if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '../../Scripts/';
  IntelliFactory.Runtime.Start();
}
</script>

    <script src="//unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="//unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
    <script>
      $(document).ready(function () {
        var $container = $('.masonry');
        $container.imagesLoaded(function () {
          $container.masonry({
            itemSelector: '.masonry-item',
            percentPosition: true,
            horizontalOrder: true
          });
        });
      });
    </script>
  </footer>
</body>
</html>