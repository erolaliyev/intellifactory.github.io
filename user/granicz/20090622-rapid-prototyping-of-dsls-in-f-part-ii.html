<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rapid prototyping of DSLs in F# - Part II | IntelliFactory</title>
  <meta name="description" content="" />
  <script src="/themekit/scripts/jquery.min.js"></script>
  <script src="/themekit/scripts/main.js"></script>
  <link rel="stylesheet" href="/themekit/css/bootstrap-grid.css" />
  <link rel="stylesheet" href="/themekit/css/style.css" />
  <link rel="stylesheet" href="/themekit/css/content-box.css" />
  <link rel="stylesheet" href="/themekit/css/media-box.css" />
  <link rel="stylesheet" href="/themekit/css/social.css" />
  <link rel="stylesheet" href="/assets/skin.css" />
  <link rel="stylesheet" href="/assets/custom.css" />
  <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" type="text/javascript" charset="UTF-8"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/fsharp.min.js" type="text/javascript" charset="UTF-8"></script><link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/vs.min.css"></link>

</head>
<body>
  <div id="preloader"></div>
  <nav class="menu-classic  light menu-fixed menu-one-page align-right" data-menu-anima="fade-bottom" data-scroll-detect="true">
    <div class="container">
        <div class="menu-brand">
          <a href="#">
            <img class="logo-default" src="/media/logo-light.svg" alt="logo" />
            <img class="logo-retina" src="/media/logo-light.svg" alt="logo" />
            <span>IntelliFactory</span>
          </a>
        </div>
        <i class="menu-btn"></i>
        <div class="menu-cnt">
          <ul>
            <li>
              <a href="index.html">Home</a>
            </li>
            <li class="dropdown">
              <a href="#">Open Source</a>
              <ul>
                <li><a href="https://websharper.com">WebSharper</a></li>
                <li><a href="https://fsbolero.io">Bolero</a></li>
                <li><a href="https://github.com/granicz/SiteFi">SiteFi</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#">Company</a>
              <ul>
                <li><a href="/about">About</a></li>
                <li><a href="/careers">Careers</a></li>
                <li><a href="/customers">Success stories</a></li>
                <li><a href="/team">Team</a></li>
                <li><a href="/investors">For investors</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#">Services</a>
              <ul>
                <li><a href="/consulting">Consulting</a></li>
                <li><a href="/trainings">Trainings</a></li>
                <li><a href="/education">Education</a></li>
                <li><a href="/research">Research</a></li>
              </ul>
            </li>
            <li>
              <a href="/blogs">Blogs</a>
            </li>
            <li>
              <a href="/contact">Contact</a>
            </li>
          </ul>
          <div class="menu-right">
            <div class="menu-custom-area">
              <a class="btn btn-xs btn-border btn-circle" href="https://cloudsharper.com">Download CloudSharper</a>
            </div>
          </div>
          <div class="clear"></div>
        </div>
      </div></nav>

  
    
    <header class="header-image ken-burn-center align-center light boxed-page-header" data-parallax="true" data-natural-height="600" data-natural-width="1920" data-bleed="0" data-image-src="http://via.placeholder.com/1920x700" data-offset="0">
      <div class="container">
        <h1>Rapid prototyping of DSLs in F# - Part II</h1>
        <h2>20090622</h2>
        <ol class="breadcrumb">
          <li><a href="/index.html">Home</a></li>
          <li><a href="/blogs">Blogs</a></li>
          <li><a href=""></a></li>
        </ol>
      </div>
    </header>
    <main>
      <section class="section-base boxed-page">
        <div class="container">
          <div class="row">
            <div class="col-lg-9 text-color">
              <div><div ws-preserve=""><p>This is the second article in the &quot;Rapid prototyping of DSLs in F#&quot; series that summarizes the talks I gave at CEFP 2009 and goes beyond. Here is the short build-up of the series:</p>
<ul>
<li>Part I - <a href="//intellifactory.com/user/granicz/20090523-parsing-with-active-patterns">Parsing with active patterns</a> - parsing a small expression language</li>
<li>Part II - (current) Parser for Simply, a small programming language with functions and expressions</li>
<li>Part III - (coming soon) Semantic analysis for Simply programs</li>
<li>Part IV - (coming soon) Building a shell around Simply and instantiating it for a Logo-like language</li>
</ul>
<p><img src="/assets/Simply-Logo.png" alt="" /></p>
<p>It has been almost three years since my <a href="http://www.intellifactory.com/articles/LogoInterpreter.aspx">&quot;A Logo interpreter under 400 lines&quot;</a> article, a long time in any article's life. I am glad to see it being used in interesting ways by so many people (for example, <a href="http://through-the-interface.typepad.com/through_the_interface/">Kean Walmsley</a> from Autodesk did a <a href="http://through-the-interface.typepad.com/through_the_interface/2008/07/a-simple-3d-log.html">3D implementation</a> as an AutoCAD plugin), and I still get a few comments on it now and then.</p>
<p>The Logo-like language I implemented in the above article used a context-sensitive parser that accepted function calls only if the corresponding function definition was encountered beforehand - mostly to save some time and parse programs into a representation that was more readily executable without doing a separate phase of semantic checking.</p>
<p>For the CEFP 2009 example I wanted to get back to a more conventional parsing implementation and keep syntax and semantics separate. The goal of the example was to implement/establish a small programming language that had means to define and call functions, a simple control flow construct (say, repeat blocks), and support for at least the ordinary arithmetic operators with the usual precedences in its expression language.</p>
<p>Here is a bit of sample code from Simply:</p>
<pre><code class="language-fsharp">var x=1
var x=2
var x=3

fun foo(y) {
    fun bar(foo) {
        var x=x+1
        foo+x
    }
    bar(y*2)
}

repeat 1000 as x {
    foo(x)
}
</code></pre>
<p>The parser I developed in the <a href="//intellifactory.com/user/granicz/20090523-parsing-with-active-patterns">first article</a> of this series provides the perfect foundation to build upon. If you have played with that parser and want to make it work with this and the upcoming articles, you should wrap it inside a Language module, something like this:</p>
<pre><code class="language-fsharp">namespace IntelliFactory.Simply

module Language =
    open System
    open System.Text.RegularExpressions

    let private matchToken pattern s =
        ...
</code></pre>
<p>The expression language defined there only covered arithmetic on floating-point numbers and variables. For the purposes of this series, Simply will support the same - so the only values in Simply are floats, and as a result the language will not include conditionals (and thus no useful recursive functions either).</p>
<p>But don't worry - adding multiple types and conditionals to Simply is relatively straightforward, and I will address this as an appendix to the series.</p>
<p>Recall that I used the Ast module to contain the type that the parser used for encoding expressions. Here I am going to change that representation slightly and tag a couple additional types for encoding commands and programs:</p>
<pre><code class="language-fsharp">module Ast =
    type var = string

    type Expr =
        | Number   of float
        | BinOp    of (float -&gt; float -&gt; float) * Expr * Expr
        | Var      of var
        | FunApply of var * Expr list
        
        static member Sum (e1, e2)   = BinOp (( + ), e1, e2)
        static member Diff (e1, e2)  = BinOp (( - ), e1, e2)
        static member Prod (e1, e2)  = BinOp (( * ), e1, e2)
        static member Ratio (e1, e2) = BinOp (( / ), e1, e2)

    type Command =
        | Repeat   of Expr * var * Command
        | FunDef   of var * var list * Command
        | Sequence of Expr list
        | VarDef   of var * Expr
        | Yield    of Expr

    type Prog = Program of Command list
</code></pre>
<p>I can now add the parser rules for commands and entire programs. First, let's add the rules for the tokens Simply uses:</p>
<pre><code class="language-fsharp">    let (|LBRACE|_|) s = &quot;{&quot;      |&gt; MatchSymbol s
    let (|RBRACE|_|) s = &quot;}&quot;      |&gt; MatchSymbol s
    let (|EQ|_|)     s = &quot;=&quot;      |&gt; MatchSymbol s

    let (|VAR|_|)    s = &quot;var&quot;    |&gt; MatchSymbol s
    let (|FUN|_|)    s = &quot;fun&quot;    |&gt; MatchSymbol s
    let (|REPEAT|_|) s = &quot;repeat&quot; |&gt; MatchSymbol s
    let (|AS|_|)     s = &quot;as&quot;     |&gt; MatchSymbol s
</code></pre>
<p>Commands differ from expressions in that they don't have a return value, and Simply programs are basically a list of commands. A command can be a variable or function definition, or a repeat block. Commands can also be sequenced (this is how you define function bodies), and they can invoke any expression (Yield here is not exactly a return command - it is simply a tag to stand for executing arbitrary expressions.)</p>
<pre><code class="language-fsharp">    let rec (|Command|_|) = function
        | LBRACE (Star (|Command|_|) [] (commands, RBRACE rest)) -&gt;
            (Ast.Command.Sequence commands, rest) |&gt; Some
        | REPEAT (Expression (i, AS (ID (v, Command (body, rest))))) -&gt;
            (Ast.Command.Repeat (i, v, body), rest) |&gt; Some
        | FUN (ID (f, LPAREN (Star (|ID|_|) [] (pars, RPAREN (Command (body, rest)))))) -&gt;
            (Ast.Command.FunDef (f, pars, body), rest) |&gt; Some
        | VAR (ID (v, EQ (Expression (expr, rest)))) -&gt;
            (Ast.Command.VarDef (v, expr), rest) |&gt; Some
        | Expression (e, rest) -&gt;
            (Ast.Command.Yield e, rest) |&gt; Some
        | _ -&gt;
            None

    let (|Prog|_|) = function
        | Star (|Command|_|) [] (commands, rest) -&gt;
            (Ast.Prog.Program commands, rest) |&gt; Some
        | _ -&gt;
            None
</code></pre>
<p>With these handful of rules, I can now parse Simply programs. Here is a short F# Interactive session (slightly modified for better readability) for parsing the example Simply program from earlier:</p>
<pre><code class="language-fsharp">open Language
    
&quot;
var x=1
var x=2
var x=3

fun foo(y) {
    fun bar(foo) {
        var x=x+1
        foo+x
    }
    bar(y*2)
}

repeat 1000 as x {
    foo(x)
}&quot;
|&gt; (|Prog|_|)
|&gt; printf &quot;Result=%A\n&quot;;;

val it : unit = ()
&gt; 
Result=Some
  (Program
     [VarDef (&quot;x&quot;,Number 1.0);
      VarDef (&quot;x&quot;,Number 2.0);
      VarDef (&quot;x&quot;,Number 3.0);
      FunDef
        (&quot;foo&quot;,[&quot;y&quot;],
         Sequence
           [FunDef
              (&quot;bar&quot;,[&quot;foo&quot;],
               Sequence
                 [VarDef (&quot;x&quot;,BinOp (&lt;fun:Sum@44&gt;,Var &quot;x&quot;,Number 1.0));
                  Yield (BinOp (&lt;fun:Sum@44&gt;,Var &quot;foo&quot;,Var &quot;x&quot;))]);
            Yield (FunApply (&quot;bar&quot;,[BinOp (&lt;fun:Prod@46&gt;,Var &quot;y&quot;,Number 2.0)]))]);
      Repeat (Number 1000.0,&quot;x&quot;,Sequence [Yield (FunApply (&quot;foo&quot;,[Var &quot;x&quot;]))])],
   &quot;&quot;)
&gt;
</code></pre>
<p>This completes the parser for Simply. In the next couple articles I will look at semantic analysis and evaluating of Simply programs, loading up the evaluation environment with useful built-in functions, and erecting a simple development shell around Simply to instantiate for different target domains (Logo in particular). So stay tuned!</p>
</div></div>
              <hr class="space" />
              <div class="row">
                <div class="col-lg-8">
                  <ul class="icon-list icon-list-horizontal icon-list-blog">
                    <li>
                      <i class="icon-bookmark"></i>
                      <a href="#">Finance</a>,
                      <a href="#">Software</a>
                    </li>
                  </ul>
                </div>
              </div>
              <hr class="space" />
              <div class="icon-links icon-links-button full-width icon-social social-colors">
                <a data-social="share-facebook" class="facebook"><i class="icon-facebook"></i></a>
                <a data-social="share-twitter" class="twitter"><i class="icon-twitter"></i></a>
                <a data-social="share-linkedin" class="linkedin"><i class="icon-linkedin"></i></a>
                <a data-social="share-pinterest" class="pinterest"><i class="icon-pinterest"></i></a>
              </div>
              <hr />
              <div class="cnt-box cnt-box-side box-small">
                <a href="#" class="img-box"><img src="http://via.placeholder.com/450x450" alt="" /></a>
                <div class="caption">
                  <h2>Richard Scally</h2>
                  <p>
                    Lorem ipsum dolor sitamet consectetur adipisicing elito sed do eiusmod tempore ectetur adipia.
                  </p>
                </div>
              </div>
              <hr />
              <h2>Related articles.</h2>
              <hr class="space-sm" />
              <div class="grid-list" data-columns="2" data-columns-sm="1">
                <div class="grid-box">
                  <div class="grid-item">
                    <div href="#" class="cnt-box cnt-box-top-icon boxed doc-boxed align-left">
                      <div class="caption">
                        <h2>Jessica Adams Exibition In New York With After Show</h2>
                        <div class="extra-field">Technology</div>
                        <p>
                          October 25, 2019
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="grid-item">
                    <div href="#" class="cnt-box cnt-box-top-icon boxed doc-boxed align-left">
                      <div class="caption">
                        <h2>How to change your business and make money</h2>
                        <div class="extra-field">Business</div>
                        <p>
                          October 24, 2019
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 widget">
              
              <div>
                <h3>Categories</h3>
                <hr class="space-xs" />
                <div class="tabs"><div>
                    <a href="/category/dsl">
                      dsl
                    </a>
                  </div><div>
                    <a href="/category/fsharp">
                      fsharp
                    </a>
                  </div><div>
                    <a href="/category/websharper">
                      websharper
                    </a>
                  </div></div>
                <hr class="space-sm" />
                <h3>Latest posts</h3>
                <hr class="space-sm" />
                <div class="menu-inner menu-inner-vertical menu-inner-image">
                    <ul>
                      <li>
                        <a href="/user/denuziere/20200523-bolero-0-13-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.13 released" />
                          Bolero 0.13 released
                          <span>05/23/2020</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20200323-bolero-0-12-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.12 released" />
                          Bolero 0.12 released
                          <span>03/23/2020</span>
                        </a>
                      </li><li>
                        <a href="/user/granicz/20200116-converting-a-websharper-html-app-to-a-client-server-one">
                          <img src="http://via.placeholder.com/400x400" alt="Converting a WebSharper HTML app to a client-server one" />
                          Converting a WebSharper HTML app to a client-server one
                          <span>01/16/2020</span>
                        </a>
                      </li><li>
                        <a href="/user/granicz/20191226-f-metablogging-introducing-blogengine-for-your-static-markdown-based-f-blog">
                          <img src="http://via.placeholder.com/400x400" alt="F# metablogging: introducing BlogEngine for your static markdown-based F# blog" />
                          F# metablogging: introducing BlogEngine for your static markdown-based F# blog
                          <span>12/26/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190924-bolero-0-9-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.9 released" />
                          Bolero 0.9 released
                          <span>09/24/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/granicz/20190905-your-first-bolero-project-not-compiling-try-this">
                          <img src="http://via.placeholder.com/400x400" alt="Your first Bolero project not compiling? Try this!" />
                          Your first Bolero project not compiling? Try this!
                          <span>09/05/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190805-bolero-0-7-released">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.7 released" />
                          Bolero 0.7 released
                          <span>08/05/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190530-bolero-0-5-released-for-blazor-3-0-preview">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.5 released for Blazor 3.0-preview" />
                          Bolero 0.5 released for Blazor 3.0-preview
                          <span>05/30/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/denuziere/20190417-bolero-0-4-released-with-remote-authentication">
                          <img src="http://via.placeholder.com/400x400" alt="Bolero 0.4 released with remote authentication" />
                          Bolero 0.4 released with remote authentication
                          <span>04/17/2019</span>
                        </a>
                      </li><li>
                        <a href="/user/jankoa/20190226-websharper-4-5-8-released-with-visual-studio-2019-support">
                          <img src="http://via.placeholder.com/400x400" alt="WebSharper 4.5.8 released with Visual Studio 2019 support" />
                          WebSharper 4.5.8 released with Visual Studio 2019 support
                          <span>02/26/2019</span>
                        </a>
                      </li>
                      
                    </ul>
                  </div>
                <hr class="space-sm" />
                <h3>Twitter</h3>
                <hr class="space-sm" />
                <div class="social-feed social-feed-tw social-slider" data-social-id="twitter" data-options="count:8,arrows:true,nav:true,controls:out,type:carousel,perView:1"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  
  <i class="scroll-top-btn scroll-top show"></i>
  <footer class="footer light">
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <h4>Company and team</h4>
          <div class="menu-inner menu-inner-vertical">
            <ul>
              <li>
                <a href="#">Company details and team</a>
              </li>
              <li>
                <a href="#">News and blog</a>
              </li>
              <li>
                <a href="#">Press area</a>
              </li>
              <li>
                <a href="#">Affiliates and marketing</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <h4>Help and support</h4>
          <div class="menu-inner menu-inner-vertical">
            <ul>
              <li>
                <a href="#">Help centre</a>
              </li>
              <li>
                <a href="#">Feedbacks</a>
              </li>
              <li>
                <a href="#">Request new features</a>
              </li>
              <li>
                <a href="#">Contact us</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <h4>Learn more</h4>
          <div class="menu-inner menu-inner-vertical">
            <ul>
              <li>
                <a href="#">Apps stores</a>
              </li>
              <li>
                <a href="#">Partners</a>
              </li>
              <li>
                <a href="#">Privacy and terms</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3">
          <h4>Follow us</h4>
          <div class="icon-links icon-social icon-links-grid social-colors">
            <a class="facebook"><i class="icon-facebook"></i></a>
            <a class="twitter"><i class="icon-twitter"></i></a>
            <a class="linkedin"><i class="icon-linkedin"></i></a>
            <a class="youtube"><i class="icon-youtube"></i></a>
            <a class="instagram"><i class="icon-instagram"></i></a>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bar">
      <div class="container">
        <span>© Codrop LTD 2019. Codrop is a powerful Landing Page App Template built with <a target="_blank" href="https://themekit.dev/code/">Themekit</a> by the <a target="_blank" href="https://schiocco.com/">Schiocco</a> Team. </span>
        <span><img src="/media/logo-light.svg" /></span>
      </div>
    </div>
    <link rel="stylesheet" href="/themekit/media/icons/iconsmind/line-icons.min.css" />
    <script src="/themekit/scripts/parallax.min.js"></script>
    <script src="/themekit/scripts/imagesloaded.min.js"></script>
    <script src="/themekit/scripts/pagination.min.js"></script>
    <script src="/themekit/scripts/social.min.js"></script>
    <script src="/themekit/scripts/tab-accordion.js"></script>
    <script src="/media/custom.js"></script>
    <script src="/js/Client.js"></script>
    <meta id='websharper-data' name='websharper-data' content='{"$TYPES":[],"$DATA":{"$V":{}}}' />
<script src="../../Scripts/WebSharper.Core.JavaScript/Runtime.js" type="text/javascript" charset="UTF-8"></script><script type="text/javascript">
if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '../../Scripts/';
  IntelliFactory.Runtime.Start();
}
</script>

    <script src="//unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="//unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
    <script>
      $(document).ready(function () {
        var $container = $('.masonry');
        $container.imagesLoaded(function () {
          $container.masonry({
            itemSelector: '.masonry-item',
            percentPosition: true,
            horizontalOrder: true
          });
        });
      });
    </script>
  </footer>
</body>
</html>